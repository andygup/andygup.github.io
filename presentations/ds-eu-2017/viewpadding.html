
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>View Padding</title>

    <link rel="stylesheet" href="http://esironal.github.io/cmtouch/lib/codemirror.css">
    <link rel="stylesheet" href="http://esironal.github.io/cmtouch/addon/hint/show-hint.css">
    <script src="http://esironal.github.io/cmtouch/lib/codemirror.js"></script>
    <script src="http://esironal.github.io/cmtouch/addon/hint/show-hint.js"></script>
    <script src="http://esironal.github.io/cmtouch/addon/hint/xml-hint.js"></script>
    <script src="http://esironal.github.io/cmtouch/addon/hint/html-hint.js"></script>
    <script src="http://esironal.github.io/cmtouch/mode/xml/xml.js"></script>
    <script src="http://esironal.github.io/cmtouch/mode/javascript/javascript.js"></script>
    <script src="http://esironal.github.io/cmtouch/mode/css/css.js"></script>
    <script src="http://esironal.github.io/cmtouch/mode/htmlmixed/htmlmixed.js"></script>
    <script src="http://esironal.github.io/cmtouch/addon/selection/active-line.js"></script>
    <script src="http://esironal.github.io/cmtouch/addon/edit/matchbrackets.js"></script>

    <link rel="stylesheet" href="http://esironal.github.io/cmtouch/theme/neonsyntax.css">

    <link rel="stylesheet" href="https://js.arcgis.com/4.5/esri/css/main.css">
    <link rel="stylesheet" href="css/demo.css">
    <script src="demo.js"></script>

    <style>
        html,
        body,
        #viewDiv {
            font-family: Helvetica, Arial, Sans-Serif;
            overflow: hidden;
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }

        #slider {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            padding: 0;
            margin: 0;
            width: 300px;
            margin-right: -280px;
        }

        #slider-content {
            position: absolute;
            right: 0;
            top: 0;
            left: 20px;
            bottom: 0;
            padding: 0;
            margin: 0;
            background-color: #000;
            opacity: 0.8;
        }

        #legendDiv {
            color: #fff;
            font-size: 4em;
            padding: 20px;
        }

        #legendDiv img {
            position: absolute;
            bottom: 0;
            left: 0;
        }

        #legendDiv em {
            color: #fff;
            position: absolute;
            top: 0;
        }

        #btnExpand {
            width: 20px;
            height: 100%;
            float: left;
            background-color: #56a5d8;
        }

        #options {
            padding: 30px;
        }

        .demo-title {
            padding-right: 20px;
        }

        .esri-view-height-less-than-small .esri-popup__main-container,
        .esri-view-height-less-than-medium .esri-popup__main-container,
        .esri-view-height-less-than-large .esri-popup__main-container,
        .esri-view-height-less-than-xlarge .esri-popup__main-container{
            width: 300px;
        }

    </style>

    <script src="https://js.arcgis.com/4.5/"></script>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/widgets/Legend",
            "esri/layers/FeatureLayer",
            "esri/renderers/SimpleRenderer",
            "esri/symbols/SimpleMarkerSymbol",
            "dojo/domReady!"
        ], function(Map, MapView, Legend, FeatureLayer, SimpleRenderer, SimpleMarkerSymbol) {

            var demoTitle = document.getElementById("hd");

            var btnExpand = document.getElementById("btnExpand");
            var slider = document.getElementById("slider");
            var legendDiv = document.getElementById("legendDiv");
            var optionsContainer = document.getElementById("options");
            var defaultPadding = 20;
            var enableViewPadding = true;


            const pointRenderer = new SimpleRenderer({
                symbol: new SimpleMarkerSymbol({
                    size: 6,
                    color: "black",
                    outline: {
                        width: 0.5,
                        color: "white"
                    }
                })
            });

            var popupTemplate = { // autocasts as new PopupTemplate()
                title: "{Name}",
                    content: [{
                    type: "fields",
                    fieldInfos: [{
                        fieldName: "Name"
                    }, {
                        fieldName: "Platform__"
                    }]
                }]
            }

            // Get FeatureLayer url from ArcGIS Online
            let featureLayer = new FeatureLayer({
                url: "http://services.arcgis.com/WQ9KVmV6xGGMnCiQ/arcgis/rest/services/Tube_Stations_London_Marathon/FeatureServer/0",
                //url: "https://services.arcgis.com/uCXeTVveQzP4IIcx/arcgis/rest/services/NYC_Taxi_Data_Snapshot/FeatureServer/0",
                outFields: ["Name","Platform__"],
                renderer: pointRenderer,
                popupTemplate: popupTemplate
            });

            var map = new Map({
                basemap: "streets"
            })

            var view = new MapView({
                container: "viewDiv",
                map: map,

                // Extent information take from Feature Service
                extent: { // autocast to an Extent class
                    xmin: -68014.6977999993,
                    ymin: 6692753.2988,
                    xmax: 28026.9081999995,
                    ymax: 6747001.2608,
                    spatialReference: 102100
                },
                padding: {
                    right: defaultPadding
                }
            });

            map.add(featureLayer);

            view.then(function() {
                view.ui.add(optionsContainer, "top-right");

                var popup = view.popup;
                popup.viewModel.on("click", function(e){
                    view
                })
                /*
                var legend = new Legend({
                  container: legendDiv,
                  view: view,
                  layerInfos: [{
                    layer: ccLayer,
                    title: "Accidental Deaths"
                  }]
                });
                */
            });

            var margin = -280;
            var increment = 1;

            // http://codereview.stackexchange.com/questions/106946/simple-animation-method-with-requestanimationframe-code-structure
            function animate(options) {
                options = options || {};

                // defaults
                var duration = options.duration || 500,
                    ease = options.easing || function (a) { return a }, // basic linear easing
                    onProgress = options.onProgress || function () {},
                    onComplete = options.onComplete || function () {},
                    from = options.from || {},
                    to = options.to || {};

                // runtime variables
                var startTime = Date.now();

                function update() {
                    var deltaTime = Date.now() - startTime,
                        progress = Math.min(deltaTime / duration, 1),
                        factor = ease(progress),
                        values = {},
                        property;

                    for(property in from) {
                        if(from.hasOwnProperty(property) && to.hasOwnProperty(property)) {
                            values[property] = from[property] + (to[property] - from[property]) * factor;
                        }
                    }

                    onProgress(values);

                    if(progress === 1) {
                        onComplete(deltaTime);
                    } else {
                        requestAnimationFrame(update);
                    }
                }

                requestAnimationFrame(update);
            }

            function inExpo(t) {
                return Math.pow(2, 10 * (t - 1));
            }

            function outExpo(t) {
                return inExpo(1 - t);
            }

            function inOutExpo(t) {
                return t < 0.5 ? inExpo(t * 2) / 2 : (outExpo((t - 0.5) * 2) + 1) / 2;
            }

            function inSine(t) {
                return -Math.cos(t * Math.PI / 2) + 1;
            }

            function updatePadding(value) {
                return { right: value - margin + defaultPadding };
            }

            function expand() {
                animate({
                    easing: inSine,
                    onProgress: function(values) {
                        slider.style.marginRight = values.a + "px";
                        if (enableViewPadding) {
                            view.padding = updatePadding(values.a);
                            demoTitle.style.width =  (window.innerWidth - (values.a - margin)).toString() + "px";
                            console.log("padding " + demoTitle.style.width)
                        }
                    },
                    onComplete: function() {
                        btnExpand.removeEventListener("click", expand);
                        btnExpand.addEventListener("click", collapse);
                    },
                    from: { a: margin },
                    to: { a: 0 }
                });
            }

            function collapse() {
                animate({
                    easing: inSine,
                    onProgress: function(values) {
                        slider.style.marginRight = values.a + "px";
                        if (enableViewPadding) {
                            view.padding = updatePadding(values.a);
                            demoTitle.style.width =  (window.innerWidth - (values.a - margin)).toString() + "px";
                            console.log("padding " + demoTitle.style.width)
                        }
                    },
                    onComplete: function() {
                        btnExpand.removeEventListener("click", collapse);
                        btnExpand.addEventListener("click", expand);
                    },
                    from: { a: 0 },
                    to: { a: margin }
                });
            }

            btnExpand.addEventListener("click", expand);
            document.getElementById("padding").addEventListener("change", function() {
                enableViewPadding = !enableViewPadding;
            });
        });
    </script>
</head>

<body>

<header id="hd">
    <section class="demo-version">
        <span>4.x</span>
    </section>
    <section class="demo-title">
        <span>View Padding</span>
        <span class="btn-demo">Code</span>
    </section>
</header>


<div id="code" class="code right shadowed" style="width: 800px;">
    <textarea id="codemirror">
const ageClasses = [
  { minValue: 1900, maxValue: 1924, color: [153, 167, 204] },
  { minValue: 1925, maxValue: 1949, color: [149, 184, 214] },
  { minValue: 1950, maxValue: 1974, color: [153, 204, 203] },
  { minValue: 1975, maxValue: 1999, color: [153, 204, 179] },
  { minValue: 2000, maxValue: 2024, color: [175, 206, 152] }
];
const classBreakInfos =
  ageClasses.map(({ color, minValue, maxValue }) => {
    return {
      minValue: minValue,
      maxValue: maxValue,
      symbol: {
        type: "mesh-3d",
        symbolLayers: [{
          type: "fill",
          material: {
            color: color
          }
        }]
      }
    };
  });
    </textarea>
</div>

<div id="options" class="esri-widget">
    <input id="padding" type="checkbox"  checked /> Padding?
</div>
<div id="viewDiv"></div>
<div id="slider">
    <div id="btnExpand" class="light-blue"></div>
    <div id="slider-content">
        <div id="legendDiv">
            <!--<em>Hello</em>-->
            <iframe src="https://developers.arcgis.com/javascript/latest/api-reference/esri-views-View.html#padding" height="100%" width="100%"></iframe>
        </div>
    </div>
</div>
</body>
</html>